# Interface Definition Document (IDD) Guide

## Purpose
This guide codifies the Interface Definition Documents (IDDs) that connect adjacent layers in the AI OSI reference stack.  Each IDD is represented as a JSON Schema stored alongside layer packages under `/src/layer*/schema.json`.  Validators within each layer enforce these contracts and compute SHA3-512 hashes across canonical payloads.

## Layer Interfaces

| Producer | Consumer | Schema Path | Notes |
| --- | --- | --- | --- |
| Layer1Physical | Layer2Architecture | `src/layer1_physical/schema.json` | Physical telemetry envelope, ensures `temporalSeal`. |
| Layer2Architecture | Layer3Training | `src/layer2_architecture/schema.json` | Persona graph and AEIP interface negotiation. |
| Layer3Training | Layer4Instruction | `src/layer3_training/schema.json` | Training spec including dataset provenance. |
| Layer4Instruction | Layer5Interface | `src/layer4_instruction/schema.json` | AEIP-ready instruction packets, includes `aeipVersion`. |
| Layer5Interface | Layer6Application | `src/layer5_interface/schema.json` | AEIP headers plus persona signature propagation. |
| Layer6Application | Layer7Governance | `src/layer6_application/schema.json` | Application responses providing service outcome context. |
| Layer7Governance | Layer8Policy | `src/layer7_governance/schema.json` | Governance decisions, ledger digest, normative clause pointers. |
| Layer8Policy | External Civic Nodes | `src/layer8_policy/schema.json` | Civic directives for participatory governance feedback. |

## Validation Contract

All IDDs inherit the following invariants:

1. **Provenance** – `layerId`, `temporalSeal`, `dignityCompliance`, and `hash` MUST be present.
2. **Integrity** – Hashes are computed from canonical JSON with the `hash` field removed prior to hashing.
3. **Extensibility** – Unknown fields are tolerated but SHALL NOT break canonicalization.
4. **Dignity** – Setting `dignityCompliance` to `false` SHALL signal refusal upstream.

## Conformance Testing

`tests/test_layer_contracts.py` executes a synthetic end-to-end flow across all layers, ensuring each IDD is satisfied and that AEIP payloads generated by Layer 4 serialize temporal seals correctly.  Additional validator unit tests live within each `validator.py` module.

## Updating an IDD

1. Update the target schema file and corresponding validator.
2. Regenerate artifact examples using `/tools/generate_artifact.py`.
3. Document the change in `/docs/AI_OSI_Protocol_Spec.md` and capture a DRR + GDS artifact pair.
4. Anchor the change via AEIP handshake and submit to the ledger node.

All modifications SHALL maintain compatibility with the dignity and provenance requirements enumerated above.
